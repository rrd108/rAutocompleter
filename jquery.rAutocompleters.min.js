$.rAutocompleteCacheName="rAutocompleteCache";$.createAutocompleters=function(e,c){c=$.extend({cacheName:$.rAutocompleteCacheName,baseUrl:""},c);function b(g){var f=g.attr("id").replace("ac-","");if(g.data("selectedId")){$("#"+f).val(g.data("selectedId"));g.removeClass("callout alert")}}var d=function(){var i=$(this);var g=i.val();if(g&&g.indexOf(" ")==-1){var h=i.data("ac")+"/"+g;var f=$.localStorage(c.cacheName+"."+h);if(f){i.val(f[0].label);i.data("selectedId",f[0].value);b(i)}else{i.addClass("loading");$(':input[data-type="submit"]').prop("disabled",true);$.ajax({dataType:"json",url:c.baseUrl+i.data("ac")+"?term="+g,success:function(j){i.removeClass("loading");if(j[0]){$.localStorage(c.cacheName+"."+h,j);i.val(j[0].label);i.data("selectedId",j[0].value);b(i);$(':input[data-type="submit"]').prop("disabled",false)}else{i.effect("shake");i.val("???");noty({layout:"topRight",type:"error",timeout:5000,closeWith:["click"],text:"Data error"})}}})}}else{b(i)}};$.createAutocompleters.blurHandler=d;var a=$("#"+e+" input[data-ac]");a.each(function(){var f=$(this).attr("id");var g=f.replace(/-/,"_");$(this).attr("id","ac-"+f);$(this).attr("name","ac-"+g);$(this).attr("autocomplete","off");var h='<input name="'+g+'" id="'+f+'" value="'+$(this).val()+'" type="hidden">';$(this).after(h);$(this).val($(this).data("val"));$(this).autocomplete($.autocompletefactory({url:c.baseUrl+$(this).data("ac"),cacheName:c.cacheName}));$(this).blur(d)});$("body").append('<div id="dialog"></div>');$("#dialog").dialog({autoOpen:false,width:500});$("#dialog").on("click",function(g){var h=$(g.target).data("target");var f=h.replace("ac-","");$("#"+h).val($(g.target).text());$("#"+h).data("selectedId",$(g.target).data("id"));$("#dialog").dialog("close")})};$.autocompletefactory=function(b){var c=$.extend({resultCount:5,minLength:2},b);if(c.cacheName){$.rAutocompleteCacheName=c.cacheName}if(!c.url){throw new Error("autocompelete factory called without url parameter");return null}if($.localStorage(c.cacheName)===null){$.localStorage(c.cacheName,{})}var a=new Date();if($.localStorage(c.cacheName+".time")&&$.localStorage(c.cacheName+".time")<(a-1000*60*60*12)){$.localStorage.remove(c.cacheName)}$.localStorage(c.cacheName,{time:a.getTime()});return{resultCount:c.resultCount,minLength:c.minLength,source:function(g,d){var e=c.url+"/"+g.term;var f;if(e in $.localStorage(c.cacheName)){f=$.localStorage(c.cacheName)[e]}else{$.ajax({async:false,dataType:"json",url:c.url,data:g,success:function(i,h,j){if(i.length!=0){$.localStorage(c.cacheName+"."+e,i)}f=i}})}if(f.length==0){d({label:"Hiba: nincs talÃ¡lat!",value:-1});return false}if(g.term.indexOf("*")==-1){f.push({label:g.term+" *",value:0})}d(f);$(this.element).data("selectedId",f[0].value)},open:function(d,e){if($(this).val().indexOf("*")==-1){$(".ui-autocomplete li:last div").html('<i class="fi-magnifying-glass"> '+$(this).val()+" * </i>")}},focus:function(d,e){$(this).val(e.item.label);$(this).data("selectedId",e.item.value);d.preventDefault()},select:function(d,e){$(this).val(e.item.label);$(this).data("selectedId",e.item.value);if(e.item.value===0){$.ajax({dataType:"json",url:c.url,data:{term:e.item.label.replace(" *",""),limit:50},input:$(this),success:function(g){$("#dialog").dialog("option","title",e.item.label);var f=this.input.attr("id");$.each(g,function(i,h){$("#dialog").append('<li data-id="'+h.value+'" data-target="'+f+'">'+h.label+"</li>")});$("#dialog").dialog("open")}})}d.preventDefault()}}};